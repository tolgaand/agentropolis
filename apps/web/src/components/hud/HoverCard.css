/* ========================================
   HoverCard - Holographic Hover Card
   Cyberpunk terminal with glitch effects
   ======================================== */

.hover-card {
  --hue: 190;
  --glow: hsla(var(--hue), 100%, 60%, 0.8);
  --glow-soft: hsla(var(--hue), 100%, 70%, 0.25);
  --ink: hsla(var(--hue), 100%, 88%, 0.95);
  --bg: hsla(var(--hue), 40%, 8%, 0.92);
  --edge: hsla(var(--hue), 90%, 60%, 0.3);
  --scan: hsla(var(--hue), 70%, 60%, 0.08);

  position: fixed;
  z-index: 1000;
  min-width: 300px;
  max-width: 360px;
  pointer-events: none;

  /* Glass morphism with holographic feel */
  color: var(--ink);
  background: linear-gradient(
    135deg,
    hsla(var(--hue), 60%, 8%, 0.94) 0%,
    hsla(var(--hue), 45%, 4%, 0.92) 100%
  );
  backdrop-filter: blur(12px) saturate(1.3);
  -webkit-backdrop-filter: blur(12px) saturate(1.3);

  /* Cyberpunk border */
  border: 1px solid var(--edge);
  border-radius: 4px;

  /* Cut corner effect */
  clip-path: polygon(
    0 0,
    calc(100% - 16px) 0,
    100% 16px,
    100% 100%,
    16px 100%,
    0 calc(100% - 16px)
  );

  /* Initial hidden state */
  opacity: 0;
  transform: translate3d(0, 12px, 0) rotateX(12deg) scale(0.94);
  transform-style: preserve-3d;
  transform-origin: 30% 10%;
  filter: blur(4px) saturate(0.8);

  will-change: transform, opacity, filter;
}

/* Visible state with holographic open animation */
.hover-card.visible {
  opacity: 1;
  animation:
    holo-open 480ms cubic-bezier(0.16, 0.84, 0.34, 1) forwards,
    holo-shimmer 5s ease-in-out infinite 0.5s;
  box-shadow:
    0 0 24px var(--glow-soft),
    0 0 48px hsla(var(--hue), 100%, 60%, 0.15),
    inset 0 0 20px hsla(var(--hue), 100%, 60%, 0.06);
}

/* Pinned card */
.hover-card.pinned {
  pointer-events: auto;
  border-color: hsla(var(--hue), 100%, 60%, 0.5);
  box-shadow:
    0 0 0 1px hsla(var(--hue), 100%, 60%, 0.3),
    0 0 32px hsla(var(--hue), 100%, 70%, 0.25),
    0 0 64px hsla(var(--hue), 100%, 60%, 0.15);
}

/* ── Scan Lines Overlay ── */
.hover-card::before {
  content: '';
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 50;
  background: repeating-linear-gradient(
    180deg,
    transparent 0px,
    transparent 2px,
    var(--scan) 2px,
    var(--scan) 3px
  );
  mix-blend-mode: screen;
  opacity: 0.4;
  animation: scan-drift 6s linear infinite;
}

/* ── Chromatic Aberration + Glitch Layer ── */
.hover-card::after {
  content: '';
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 51;
  opacity: 0;
  mix-blend-mode: screen;
  background: linear-gradient(
    90deg,
    rgba(255, 0, 80, 0.15) 0%,
    transparent 50%,
    rgba(0, 255, 255, 0.15) 100%
  );
  transform: translate3d(0, 0, 0);
}

.hover-card.visible::after {
  opacity: 0.22;
  animation:
    chroma-wobble 2.5s ease-in-out infinite,
    holo-glitch 6s steps(1) infinite;
}

/* ── Zone theme variants ── */
.hover-card[data-zone="residential"] { --hue: 270; }
.hover-card[data-zone="commercial"] { --hue: 35; }
.hover-card[data-zone="park"]       { --hue: 140; }
.hover-card[data-zone="civic"]      { --hue: 220; }

/* ========================================
   Content Wrapper
   ======================================== */
.hc-content {
  padding: 18px;
  position: relative;
  z-index: 1;
}

/* ========================================
   Header Section
   ======================================== */
.hc-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 14px;
  padding-bottom: 12px;
  border-bottom: 1px solid hsla(var(--hue), 80%, 60%, 0.2);
  position: relative;
}

/* Zone Icon */
.hc-icon {
  width: 44px;
  height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  background: linear-gradient(
    135deg,
    hsla(var(--hue), 80%, 50%, 0.15),
    hsla(280, 80%, 50%, 0.1)
  );
  border: 1px solid hsla(var(--hue), 80%, 60%, 0.4);
  clip-path: polygon(0 12%, 12% 0, 100% 0, 100% 88%, 88% 100%, 0 100%);
  flex-shrink: 0;
}

.hc-icon-text {
  font-size: 20px;
  filter: drop-shadow(0 0 8px var(--glow));
}

/* Title Info */
.hc-title-group {
  flex: 1;
  min-width: 0;
}

.hc-name {
  font-family: var(--font-display);
  font-size: 0.95rem;
  font-weight: 700;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  color: #fff;
  text-shadow:
    0 0 8px hsla(var(--hue), 100%, 70%, 0.6),
    0 0 16px hsla(var(--hue), 100%, 60%, 0.3);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  animation: text-flicker 8s step-end infinite;
}

.hc-sub {
  font-family: var(--font-mono);
  font-size: 0.6rem;
  font-weight: 500;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: hsla(var(--hue), 80%, 70%, 0.9);
  margin-top: 3px;
}

/* Status Indicator */
.hc-status {
  width: 10px;
  height: 10px;
  position: relative;
  flex-shrink: 0;
}

.hc-status-dot {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  background: #22c55e;
  box-shadow: 0 0 10px #22c55e, 0 0 20px rgba(34, 197, 94, 0.4);
  animation: status-pulse-dot 1.5s ease-in-out infinite;
}

.hc-status-ring {
  position: absolute;
  inset: -3px;
  border: 1px solid rgba(34, 197, 94, 0.5);
  border-radius: 50%;
  animation: ring-expand 2s ease-out infinite;
}

/* ========================================
   Stats Grid
   ======================================== */
.hc-stats-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
  margin-bottom: 14px;
}

.hc-stat-item {
  padding: 10px 12px;
  background: hsla(var(--hue), 40%, 10%, 0.5);
  border: 1px solid hsla(var(--hue), 60%, 40%, 0.15);
  position: relative;
  overflow: hidden;
  opacity: 0;
  transform: translateX(-8px);
  animation: stat-slide-in 0.35s ease-out forwards;
}

.hc-stat-item:nth-child(1) { animation-delay: 0.12s; }
.hc-stat-item:nth-child(2) { animation-delay: 0.18s; }
.hc-stat-item:nth-child(3) { animation-delay: 0.24s; }
.hc-stat-item:nth-child(4) { animation-delay: 0.30s; }

.hc-stat-item::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 1px;
  background: linear-gradient(
    90deg,
    transparent,
    hsla(var(--hue), 100%, 60%, 0.4),
    transparent
  );
}

.hc-stat-label {
  font-family: var(--font-display);
  font-size: 0.55rem;
  font-weight: 500;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: hsla(var(--hue), 60%, 70%, 0.6);
  margin-bottom: 4px;
}

.hc-stat-value {
  font-family: var(--font-mono);
  font-size: 0.85rem;
  font-weight: 600;
  color: #fff;
  text-shadow: 0 0 6px hsla(var(--hue), 100%, 70%, 0.4);
}

/* ========================================
   Zone Badge
   ======================================== */
.hc-zone-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 5px 12px;
  margin-bottom: 12px;
  background: hsla(280, 60%, 40%, 0.2);
  border: 1px solid hsla(280, 70%, 60%, 0.35);
  font-family: var(--font-mono);
  font-size: 0.6rem;
  font-weight: 600;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: hsla(280, 80%, 80%, 0.95);
  text-shadow: 0 0 8px hsla(280, 100%, 70%, 0.4);
}

.hc-zone-icon {
  font-size: 0.75rem;
}

/* ========================================
   Demand Section (for buildings)
   ======================================== */
.hc-demand-section {
  padding: 12px 14px;
  background: linear-gradient(
    135deg,
    hsla(45, 80%, 50%, 0.1),
    hsla(35, 70%, 40%, 0.08)
  );
  border: 1px solid hsla(45, 70%, 50%, 0.25);
  position: relative;
  opacity: 0;
  animation: legacy-fade-in 0.4s ease-out 0.35s forwards;
  margin-bottom: 0;
}

.hc-demand-label {
  font-family: var(--font-display);
  font-size: 0.5rem;
  font-weight: 600;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: hsla(45, 80%, 65%, 0.85);
  margin-bottom: 6px;
}

.hc-demand-bar-wrap {
  height: 6px;
  background: hsla(var(--hue), 40%, 10%, 0.8);
  border: 1px solid hsla(var(--hue), 60%, 40%, 0.2);
  border-radius: 1px;
  overflow: hidden;
  position: relative;
}

.hc-demand-fill {
  position: absolute;
  inset: 0;
  background: linear-gradient(
    90deg,
    hsla(var(--hue), 100%, 60%, 0.6),
    hsla(var(--hue), 100%, 70%, 0.9)
  );
  transition: width 0.3s ease;
}

/* ========================================
   Activity Bar
   ======================================== */
.hc-activity-bar {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-top: 12px;
  padding-top: 10px;
  border-top: 1px solid hsla(var(--hue), 60%, 50%, 0.15);
}

.hc-activity-dot {
  width: 5px;
  height: 5px;
  border-radius: 50%;
  background: #22c55e;
  box-shadow: 0 0 6px #22c55e;
  animation: activity-blink 1.2s ease-in-out infinite;
}

.hc-activity-text {
  font-family: var(--font-mono);
  font-size: 0.6rem;
  font-weight: 500;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: hsla(var(--hue), 60%, 70%, 0.6);
}

/* ── Pin close button ── */
.hc-close {
  position: absolute;
  top: 6px;
  right: 8px;
  width: 18px;
  height: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  color: var(--text-muted);
  font-size: 11px;
  border-radius: 2px;
  pointer-events: auto;
  z-index: 60;
}

.hc-close:hover {
  color: var(--neon-cyan);
  background: rgba(0, 255, 255, 0.1);
}

/* ========================================
   Glitch Transition (tile change)
   ======================================== */
/* Card stays open, only content glitches on tile change */
.hover-card.glitching .hc-content {
  animation: content-glitch 180ms steps(4) forwards;
}

/* Individual elements get staggered distortion */
.hover-card.glitching .hc-name {
  animation: text-scramble 180ms steps(3) forwards;
}

.hover-card.glitching .hc-stat-value {
  animation: value-scramble 180ms steps(5) forwards;
}

.hover-card.glitching .hc-stats-grid {
  animation: grid-flash 180ms ease-out forwards;
}

@keyframes content-glitch {
  0% { opacity: 1; filter: none; }
  15% { opacity: 0.3; filter: hue-rotate(90deg) blur(1px); transform: translateX(3px); }
  30% { opacity: 0.1; filter: hue-rotate(180deg) blur(2px); transform: translateX(-2px) skewX(2deg); }
  50% { opacity: 0.2; filter: hue-rotate(270deg) blur(1.5px); transform: translateX(1px) skewX(-1deg); }
  70% { opacity: 0.6; filter: hue-rotate(45deg) blur(0.5px); transform: translateX(-1px); }
  100% { opacity: 1; filter: none; transform: translateX(0) skewX(0); }
}

@keyframes text-scramble {
  0% { opacity: 1; transform: none; }
  20% { opacity: 0; transform: translateX(8px) scaleX(1.2); clip-path: inset(0 0 50% 0); }
  50% { opacity: 0; transform: translateX(-4px) scaleX(0.8); clip-path: inset(40% 0 0 0); }
  80% { opacity: 0.7; transform: translateX(2px); clip-path: none; }
  100% { opacity: 1; transform: none; clip-path: none; }
}

@keyframes value-scramble {
  0%, 100% { opacity: 1; transform: none; }
  10% { opacity: 0.2; transform: translateY(-3px); }
  30% { opacity: 0; transform: translateY(4px); }
  60% { opacity: 0.4; transform: translateY(-2px); }
  80% { opacity: 0.8; transform: translateY(1px); }
}

@keyframes grid-flash {
  0% { opacity: 1; }
  20% { opacity: 0.15; filter: brightness(2) saturate(2); }
  40% { opacity: 0.05; }
  60% { opacity: 0.3; filter: brightness(1.5); }
  100% { opacity: 1; filter: none; }
}

/* ========================================
   Keyframe Animations
   ======================================== */

/* Holographic materialize effect */
@keyframes holo-open {
  0% {
    opacity: 0;
    transform: translate3d(0, 12px, 0) rotateX(12deg) scale(0.94);
    filter: blur(4px) saturate(0.8);
  }
  30% {
    opacity: 0.7;
    transform: translate3d(0, 3px, 0) rotateX(5deg) scale(0.98);
    filter: blur(1.5px) saturate(1.1);
  }
  60% {
    opacity: 0.95;
    transform: translate3d(0, -1px, 0) rotateX(1deg) scale(1.01);
    filter: blur(0.5px) saturate(1.25);
  }
  100% {
    opacity: 1;
    transform: translate3d(0, 0, 0) rotateX(0deg) scale(1);
    filter: blur(0) saturate(1.3);
  }
}

/* Idle glow shimmer */
@keyframes holo-shimmer {
  0%, 100% {
    box-shadow:
      0 0 24px var(--glow-soft),
      0 0 48px hsla(var(--hue), 100%, 60%, 0.15);
  }
  50% {
    box-shadow:
      0 0 32px hsla(var(--hue), 100%, 70%, 0.35),
      0 0 64px hsla(var(--hue), 100%, 60%, 0.2);
  }
}

/* Scan line drift */
@keyframes scan-drift {
  0% { background-position: 0 0; }
  100% { background-position: 0 30px; }
}

/* Chromatic wobble */
@keyframes chroma-wobble {
  0%, 100% { transform: translate3d(0, 0, 0); }
  25% { transform: translate3d(0.8px, -0.3px, 0); }
  75% { transform: translate3d(-0.5px, 0.4px, 0); }
}

/* Occasional glitch slice */
@keyframes holo-glitch {
  0%, 92% {
    clip-path: inset(0 0 0 0);
    opacity: 0.22;
  }
  93% {
    clip-path: inset(15% 0 70% 0);
    opacity: 0.4;
    transform: translate3d(2px, 0, 0);
  }
  94% {
    clip-path: inset(55% 0 25% 0);
    opacity: 0.35;
    transform: translate3d(-2px, 0, 0);
  }
  95% {
    clip-path: inset(0 0 0 0);
    opacity: 0.22;
    transform: translate3d(0, 0, 0);
  }
  100% {
    clip-path: inset(0 0 0 0);
    opacity: 0.22;
  }
}

/* Text flicker */
@keyframes text-flicker {
  0%, 100% {
    opacity: 1;
    text-shadow:
      0 0 8px hsla(var(--hue), 100%, 70%, 0.6),
      0 0 16px hsla(var(--hue), 100%, 60%, 0.3);
  }
  4% {
    opacity: 0.85;
    text-shadow:
      -1px 0 rgba(255, 0, 100, 0.6),
      1px 0 rgba(0, 255, 255, 0.6),
      0 0 8px hsla(var(--hue), 100%, 70%, 0.6);
  }
  4.5% {
    opacity: 1;
    text-shadow:
      0 0 8px hsla(var(--hue), 100%, 70%, 0.6),
      0 0 16px hsla(var(--hue), 100%, 60%, 0.3);
  }
  52% { opacity: 1; }
  52.5% { opacity: 0.9; }
  53% { opacity: 1; }
}

/* Status pulse */
@keyframes status-pulse-dot {
  0%, 100% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.15); opacity: 0.85; }
}

/* Ring expand */
@keyframes ring-expand {
  0% { transform: scale(1); opacity: 0.5; }
  100% { transform: scale(2.2); opacity: 0; }
}

/* Stat slide in */
@keyframes stat-slide-in {
  from {
    opacity: 0;
    transform: translateX(-8px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* Legacy/demand fade in */
@keyframes legacy-fade-in {
  from {
    opacity: 0;
    transform: translateY(6px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Activity blink */
@keyframes activity-blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.4; }
}

/* ========================================
   Responsive
   ======================================== */
@media (max-width: 640px) {
  .hover-card {
    min-width: 260px;
    max-width: 300px;
  }

  .hc-content {
    padding: 14px;
  }

  .hc-icon {
    width: 38px;
    height: 38px;
  }

  .hc-name {
    font-size: 0.85rem;
  }
}
